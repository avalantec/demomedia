<odoo>
    <data>

    <record model="ir.ui.view" id="webform_get.get_code">

        <field name="name">WEB form GET</field>
        <field name="inherit_id" ref="website.user_navbar"/>
        
        <field name="arch" type="xml">

            <xpath expr="//li[@id='customize-menu']/div" position="inside">
                
                <a role="menuitem" class="dropdown-item" id="button_get_form">Get Form Code</a>
                    
                    <script type="text/javascript" src="https://code.jquery.com/jquery-1.7.1.min.js"/>
                    <script type="text/javascript">
                        $(document).ready( function() {
                            odoo.define('website.get_form_code', function (require) {
                            'use strict';
                            var Dialog = require('web.Dialog');

                            $('#button_get_form').click(function() {
                                const form_all = document.querySelectorAll('form');
                                if ( form_all.length == 0 ) {
                                    console.log("No Form Detected in this page");
                                    Dialog.alert(this,"No Form Detected");
                                    return
                                }

                                var data_model_name = form_all[0].getAttribute('data-model_name');
                                var form_action = form_all[0].action + data_model_name;

                                var f = document.createElement("form");
                                f.setAttribute('method',form_all[0].method);
                                f.setAttribute('action',form_action);
                                f.setAttribute('enctype','multipart/form-data');

                                var data_values_element = document.querySelectorAll('[data-values]');
                                var data_values_txt = data_values_element[0].getAttribute('data-values');
                                if ( data_values_txt ) {
                                    var data_values_txt = data_values_txt.replaceAll("'", "\"");
                                    var data_values_txt = data_values_txt.replaceAll("False", "false");
                                    console.log('If error remove the space, change from " False" to "False" ');
                                    var data_values_json = JSON.parse( data_values_txt);
                                }
                        
                                jQuery.each(data_values_json, function(key, value){
                                    if ( value != "") {
                                        var data_value = document.createElement( "input" );
                                        data_value.name = key;
                                        data_value.value = value;
                                        data_value.type = "hidden";
                                        data_value.class = "input";
                                        f.appendChild(  data_value );
                                    }
                                })

                                var data_success_page = form_all[0].getAttribute('data-success-page');
                                var url_redirect = document.createElement("input");
                                url_redirect.type = "hidden"
                                url_redirect.name = "data_success_page"
                                url_redirect.value = data_success_page
                                url_redirect.class = "input"

                                f.appendChild(  url_redirect );

                                var inputs = form_all[0].querySelectorAll("input, textarea");
                                for (var input of inputs) {
                                    var new_input = input.cloneNode(true);
                                    new_input.removeAttribute("class");
                                    f.appendChild(  new_input );
                                    f.appendChild(document.createElement("br"));
                                };

                                var input_submit = document.createElement("input");
                                input_submit.setAttribute('type',"submit");
                                input_submit.setAttribute('value',"Submit");

                                f.appendChild( input_submit );
                                
                                //==================================
                                function add_form_code ( form_txt ) {
                                
                                   var exist_div = document.getElementById( "form_code_div" );
                                   if (exist_div) {
                                      exist_div.remove();
                                   }
                                
                                   var form_code_div = document.createElement("div");
                                   form_code_div.id = "form_code_div";
                                   form_code_div.setAttribute('class','container');
                                   form_code_div.setAttribute('width','100%');

                                   var form_div_title = document.createElement("h3");
                                   form_div_title.innerText = "Form Code";
                                   form_code_div.append( form_div_title );

                                   var form_code_txt = document.createElement("textarea");
                                   form_code_txt.id = "form_txt_id";
                                   form_code_txt.class = "form-control";
                                   form_code_txt.innerText = form_txt;
                                   form_code_txt.setAttribute('style','width: 100%;');
                                   form_code_txt.setAttribute('rows','6');
                                   form_code_div.append( form_code_txt );
                                   
                                   form_code_div.append( document.createElement("br") )
                                
                                   var btn_copy = document.createElement("button");
                                   btn_copy.id = "btn_copy";
                                   btn_copy.type = "button";
                                   btn_copy.setAttribute('class','btn btn-secondary');
                                   btn_copy.setAttribute('style', 'margin-left:20px; margin-bottom:10px;');
                                   btn_copy.innerText='COPY';
                                   btn_copy.onclick = function(){
                                      copy_text_id( form_code_txt.id );
                                      document.getElementById('form_code_div').remove(); // XXXX 
                                      return false
                                   }
                                   form_code_div.append( btn_copy );
                                   
                                   var btn_close = document.createElement("button");
                                   btn_close.id = "btn_close";
                                   btn_close.type = "button";
                                   btn_close.setAttribute('class','btn btn-primary');
                                   btn_close.setAttribute('style', 'margin-left:20px; margin-bottom:10px;');
                                   btn_close.innerText='CLOSE';
                                   btn_close.onclick = function(){
                                      document.getElementById('form_code_div').remove();
                                      return false
                                   }
                                   form_code_div.append( btn_close );
                                
                                   var thisDocument = document.getElementById('wrap');  
                                   thisDocument.prepend( form_code_div );   
                                   
                                }
                                
                                function copy_text_id ( id_inhtml ) {
                                
                                   var copyText = document.getElementById( id_inhtml);
                                
                                   if ( copyText ) {
                                      copyText.select();
                                      document.execCommand("copy");
                                      return
                                   }
                                }
                                
                                add_form_code( f.outerHTML );
                            })

                        })
                    })

                </script>

            </xpath>

        </field>
        
    </record>      
  
	

    </data>
</odoo>
